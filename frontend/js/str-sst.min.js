const html=$("html"),def=["Amelogenin","CSF1PO","D2S1338","D3S1358","D5S818","D7S820","D8S1179","D13S317","D16S539","D18S51","D19S433","D21S11","FGA","Penta_D","Penta_E","TH01","TPOX","vWA"],opt=["D10S1248","D1S1656","D2S441","D6S1043","D12S391","D22S1045","DXS101","DYS391","F13A01","F13B","FESFPS","LPL","Penta_C","SE33"];let jsonInput,jsonQuery,jsonResponse,dialogImport,dialogExport,all=["Amelogenin","CSF1PO","D1S1656","D2S1338","D2S441","D3S1358","D5S818","D6S1043","D7S820","D8S1179","D10S1248","D12S391","D13S317","D16S539","D18S51","D19S433","D21S11","D22S1045","DXS101","DYS391","F13A01","F13B","FESFPS","FGA","LPL","Penta_C","Penta_D","Penta_E","SE33","TH01","TPOX","vWA"];function resetAll(){resetMarkers(),document.getElementById("input-tanabe").checked=!0,document.getElementById("input-nonempty").checked=!0,document.getElementById("check-include-Amelogenin").checked=!1,document.getElementById("filter-score").value=60,document.getElementById("filter-size").value=200,document.getElementById("results").style.display="none",document.getElementById("warning").style.display="none",document.getElementById("import-name").value="CLASTR_Results",document.getElementById("export-name").value="CLASTR_Results",document.getElementById("import-extension").value="xlsx",document.getElementById("export-extension").value="xlsx",document.getElementById("input-file").value="",document.getElementById("import-help").innerHTML="",document.getElementById("samples").innerHTML="",document.getElementById("sample-label").innerHTML="",document.getElementById("sample-label").style.display="none",document.getElementById("warning").style.opacity="0",document.getElementById("results").style.opacity="0",$("#sib_header_small,#sib_footer").width("100%"),$("#batch").button().attr("disabled",!0).addClass("ui-state-disabled"),switchIcon("import","xlsx"),switchIcon("export","xlsx")}function resetMarkers(){for(let e=0;e<def.length;e++)document.getElementById("input-"+def[e]).value="",document.getElementById("input-"+def[e]).style.color="#000000",document.getElementById("input-"+def[e]).style.borderColor="#ccc";for(let e=0;e<opt.length;e++)document.getElementById("input-"+opt[e]).value="",document.getElementById("input-"+opt[e]).style.color="#000000",document.getElementById("input-"+opt[e]).style.borderColor="#ccc",document.getElementById("check-"+opt[e]).checked=!1,document.getElementById("input-"+opt[e]).disabled=!0,document.getElementById("input-"+opt[e]).value="",document.getElementById("label-"+opt[e]).style.color="#7e7e7e"}function parseURLVariables(){if(window.location.search.length>0){let e=window.location.search.substring(1).split("&");for(let t=0;t<e.length;t++){if(void 0===e[t]||0===e[t].length||!e[t].includes("="))continue;let n=e[t].split("="),l=n[0].split("%20").join("_"),o=n[1].split("%20").join("").split("%22").join("").split("%27").join("");-1!==def.indexOf(l)?document.getElementById("input-"+l).value=o:-1!==opt.indexOf(l)?(document.getElementById("input-"+l).value=o,document.getElementById("input-"+l).disabled=!1,document.getElementById("check-"+l).checked=!0,document.getElementById("label-"+l).style.color="#107dac"):"name"===l&&(document.title="CLASTR – "+o,document.getElementById("description").value=o,document.getElementById("sample-label").innerHTML="Cellosaurus entry <b style='color:#ac3dad'>"+o+"</b> loaded",$("#sample-label").show("slide",400))}}}function bindEvents(){for(let e=0;e<def.length;e++){let t=document.getElementById("input-"+def[e]);t.onkeypress=t.onpaste=0===e?restrictXYEvent:restrictSTREvent,t.onblur=blurEvent,t.oninput=inputEvent,validateElement(t)}for(let e=0;e<opt.length;e++){let t=document.getElementById("input-"+opt[e]);t.onkeypress=t.onpaste=restrictSTREvent,t.onblur=blurEvent,t.oninput=inputEvent,validateElement(t)}window.onscroll=scrollable}function restrictXYEvent(e){if(e.ctrlKey||" "===e.key||"Backspace"===e.key||"Delete"===e.key)return!0;let t="keypress"===e.type?String.fromCharCode(e.keyCode||e.which):(e.clipboardData||window.clipboardData).getData("Text");return!/[^\sxy,]/i.test(t)}function restrictSTREvent(e){if(e.ctrlKey||" "===e.key||"Backspace"===e.key||"Delete"===e.key)return!0;let t="keypress"===e.type?String.fromCharCode(e.keyCode||e.which):(e.clipboardData||window.clipboardData).getData("Text");return!/[^\s\d,.]/.test(t)}function inputEvent(){document.getElementById("sample-label").innerHTML=""}function blurEvent(e){validateElement(document.getElementById(e.target.id))}function validateElement(e){let t=e.value.split(" ").join(""),n="color:#ff0000;border-color:#ff0000",l="color:#000000;border-color:#ccc";0===t.length?e.style=l:/[,.]{2,}|\d{3,}|(\.\d{2,}|[,.]$|^[,.])/.test(t)?e.style=n:"input-Amelogenin"===e.id?/^[xyXY](,[xyXY])?$/.test(t)?e.style=l:e.style=n:/^[0-9,.]+$/.test(t)?e.style=l:e.style=n}function scrollable(){document.body.scrollTop>20||document.documentElement.scrollTop>20?document.getElementById("scroller").style.display="block":document.getElementById("scroller").style.display="none"}function scrollUp(){document.body.scrollIntoView({behavior:"instant",block:"start",inline:"nearest"})}function switchIcon(e,t){switch(document.getElementById(e+"-xlsx").style.display="none",document.getElementById(e+"-csv").style.display="none",document.getElementById(e+"-json").style.display="none",document.getElementById(e+"-pdf").style.display="none",t){case"xlsx":document.getElementById(e+"-xlsx").style.display="block";break;case"csv":document.getElementById(e+"-csv").style.display="block";break;case"json":document.getElementById(e+"-json").style.display="block";break;case"pdf":document.getElementById(e+"-pdf").style.displfay="block"}}function jsonParameters(){let e={};return e.algorithm=$("input[name=score]:checked").val(),e.scoringMode=$("input[name=mode]:checked").val(),e.scoreFilter=document.getElementById("filter-score").value,e.maxResults=document.getElementById("filter-size").value,e.includeAmelogenin=document.getElementById("check-include-Amelogenin").checked,e}function search(){jsonQuery={};for(let e=0;e<def.length;e++){let t=document.getElementById("input-"+def[e]).value.split(" ").join("");""!==t&&(jsonQuery[def[e].split("_").join(" ")]=t)}for(let e=0;e<opt.length;e++){let t=document.getElementById("input-"+opt[e]).value.split(" ").join("");""!==t&&(jsonQuery[opt[e].split("_").join(" ")]=t)}if(0===Object.keys(jsonQuery).length)return document.getElementById("results").style.display="none",document.getElementById("warning").style.display="block",$("#warning").animate({opacity:1},400,"swing"),void document.getElementById("warning").scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"});jsonQuery.outputFormat="json",jQuery.extend(jsonQuery,jsonParameters()),html.addClass("waiting"),$.ajax({type:"POST",url:"/cellosaurus-str-search/api/query",data:JSON.stringify(jsonQuery),contentType:"application/json",dataType:"json",success:function(e){if(0!==e.results.length){jsonResponse=e,table.build(e);let t=$("#results");t.width()>$("#content").width()?$("#sib_header_small,#sib_footer").width(t.width()):$("#sib_header_small,#sib_footer").width("100%"),document.getElementById("results").style.display="table",t.animate({opacity:1},1e3,"swing"),document.getElementById("warning").style.display="none",document.getElementById("caption").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}else document.getElementById("results").style.display="none",document.getElementById("warning").style.display="block",$("#warning").animate({opacity:1},400,"swing"),document.getElementById("warning").scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},error:function(e,t,n){console.log(e),console.log(t),console.log(n),alert("Error: The server is not responding\nPlease contact an administrator")},complete:function(){html.removeClass("waiting")}})}$(document).ready(function(){resetAll(),parseURLVariables(),bindEvents()});let table={build:function(e){let t=[];Array.prototype.push.apply(t,all);for(let e=0;e<opt.length;e++)!1===document.getElementById("check-"+opt[e]).checked&&t.splice(t.indexOf(opt[e]),1);let n="",l="<tr><th class='unselectable b0'><p class=\"sort-by\">Accession</p></th><th class='unselectable'><p class=\"sort-by\">Name</p></th><th class='unselectable'><p class=\"sort-by\">Nº Markers</p></th></th><th class='unselectable'><p class=\"sort-by\">Score</p></th>";for(let e=0;e<t.length;e++){let o=t[e].split("_").join(" ");"Amelogenin"===o&&(o="Amel"),l+="<th class='unselectable'><p class=\"sort-by\">"+o+"</p></th>",n+="<td>"+document.getElementById("input-"+t[e]).value+"</td>"}l+="</tr><tr><td class='b0'>NA</td><td>Query</td><td>NA</td><td>NA</td></td>"+n+"</tr>";for(let n=0;n<e.results.length;n++){let o={};for(let s in e.results[n].profiles){for(let l in e.results[n].profiles[s].markers){let a=[];for(let t in e.results[n].profiles[s].markers[l].alleles){let o=e.results[n].profiles[s].markers[l].alleles[t];!1===o.matched?a.push("<span style='color:red'>"+o.value+"</span>"):a.push(o.value)}let r=e.results[n].profiles[s].markers[l].name.split(" ").join("_");t.indexOf(r)>-1&&(e.results[n].profiles[s].markers[l].conflicted?o[r]='<a class="as" title="'+table._formatSources(e.results[n].profiles[s].markers[l].sources)+'">'+a.join(",")+"</a>":o[r]=a.join(","))}let a,r;l+="<tr>",a="1"===$("input[name=score]:checked").val()?e.results[n].profiles[s].score>=90?"b1":e.results[n].profiles[s].score<80?"b2":"b3":e.results[n].profiles[s].score>=80?"b1":e.results[n].profiles[s].score<60?"b2":"b3",r=0==s&&2===e.results[n].profiles.length?" <span style='color:#373434'><i>Best</i></span>":1==s?" <span style='color:#373434'><i>Worst</i></span>":"",e.results[n].problematic?l+="<td class='"+a+"'><a title=\""+table._formatDescription(e.results[n].problem)+"\" style='color:red' href=\"https://web.expasy.org/cellosaurus/"+e.results[n].accession+'" target="_blank">'+e.results[n].accession+"</a>"+r+"</td>":l+="<td class='"+a+"'><a href=\"https://web.expasy.org/cellosaurus/"+e.results[n].accession+'" target="_blank">'+e.results[n].accession+"</a>"+r+"</td>",l+="<td>"+e.results[n].name+"</td>",document.getElementById("check-include-Amelogenin").checked&&e.results[n].profiles[s].markerNumber<9||!document.getElementById("check-include-Amelogenin").checked&&e.results[n].profiles[s].markerNumber<8?l+="<td><span style='color:red' title='A minimum of eight STR markers (excluding Amelogenin) is recommended'>"+e.results[n].profiles[s].markerNumber+"</span></td>":l+="<td>"+e.results[n].profiles[s].markerNumber+"</td>",l+="<td>"+e.results[n].profiles[s].score.toFixed(2)+"%</td>";for(let e=0;e<t.length;e++){let n=o[t[e]];void 0===n&&(n=""),l+="<td>"+n+"</td>"}l+="</tr>"}}let o=$("#table-results");o.empty(),o.append(l),table._makeSortable()},_formatDescription:function(e){let t="<b>Problematic cell line:</b><br><span style='color:red;'>";return t+=e.replace(".","</span>.").replace(/(PubMed=)(\d+)/g,"$1<a class='ab' href='https://www.ncbi.nlm.nih.gov/pubmed/$2' target='_blank'>$2</a>").replace(/(DOI=)([\w/.]+)/g,"$1<a class='ab' href='https://www.doi.org/$2' target='_blank'>$2</a>")},_formatSources:function(e){let t="<b>Source";e.length>1&&(t+="s"),t+=":</b><br>";for(let n=0;n<e.length;n++)if(e[n].startsWith("PubMed")){let l=e[n].indexOf("_"),o=-1===l?e[n].length:l;t+=e[n].substring(0,7),t+="<a class='ab' href='https://www.ncbi.nlm.nih.gov/pubmed/",t+=e[n].substring(7,o),t+="' target='_blank'>",t+=e[n].substring(7,o),t+="</a>",-1!==l&&(t+=e[n].substring(l)),t+="<br>"}else e[n].startsWith("DOI")?(t+=e[n].substring(0,4),t+="<a class='ab' href='https://www.doi.org/",t+=e[n].substring(4),t+="' target='_blank'>",t+=e[n].substring(4),t+="</a><br>"):(t+=e[n],t+="<br>");return t},_makeSortable:function(){const e=(e,t)=>e.children[t].innerText||e.children[t].textContent;document.querySelectorAll("th").forEach(t=>t.addEventListener("click",()=>{let n=document.querySelectorAll("th");for(let e=0;e<n.length;e++)n[e].getElementsByClassName("sort-by")[0].className="sort-by";this.asc?t.getElementsByClassName("sort-by")[0].className="sort-by asc":t.getElementsByClassName("sort-by")[0].className="sort-by des";const l=t.closest("table");Array.from(l.querySelectorAll("tr:nth-child(n+3)")).sort(((t,n)=>(l,o)=>((e,t)=>""===e||""===t||isNaN(e)||isNaN(t)?function(e,t){if(e.endsWith("%")){for(;e.length<7;)e="0"+e;for(;t.length<7;)t="0"+t}return e.toString().localeCompare(t)}(e,t):e-t)(e(n?l:o,t),e(n?o:l,t)))(Array.from(t.parentNode.children).indexOf(t),this.asc=!this.asc)).forEach(e=>l.appendChild(e))}))}};function example(){resetMarkers(),document.getElementById("input-Amelogenin").value="X",document.getElementById("input-CSF1PO").value="11,12",document.getElementById("input-D2S1338").value="19,23",document.getElementById("input-D3S1358").value="15,17",document.getElementById("input-D5S818").value="11,12",document.getElementById("input-D7S820").value="10",document.getElementById("input-D8S1179").value="10",document.getElementById("input-D13S317").value="11,12",document.getElementById("input-D16S539").value="11,12",document.getElementById("input-D18S51").value="13",document.getElementById("input-D19S433").value="14",document.getElementById("input-D21S11").value="29,30",document.getElementById("input-FGA").value="20,22",document.getElementById("input-Penta_D").value="11,13",document.getElementById("input-Penta_E").value="14,16",document.getElementById("input-TH01").value="6,9",document.getElementById("input-TPOX").value="8,9",document.getElementById("input-vWA").value="17,19",document.getElementById("description").value="HT-29",document.getElementById("sample-label").innerHTML="Example <b style='color:#ac3dad'>HT-29</b> loaded",$("#sample-label").show("slide",400)}function check(e){document.getElementById("input-"+e).disabled?(document.getElementById("input-"+e).disabled=!1,document.getElementById("label-"+e).style.color="#107dac"):(document.getElementById("input-"+e).disabled=!0,document.getElementById("input-"+e).value="",document.getElementById("label-"+e).style.color="#7e7e7e")}let importFile={read:function(e){if(void 0!==e[0])switch(e[0].name.split(".").pop()){case void 0:break;case"csv":case"tsv":case"txt":importFile._csv(e[0]);break;case"xls":importFile._xls(e[0]);break;case"xlsx":importFile._xlsx(e[0])}},load:function(e){for(let t=0;t<jsonInput.length;t++)if(jsonInput[t].description===e){resetMarkers(),document.getElementById("description").value=e;for(let e in jsonInput[t])if(jsonInput[t].hasOwnProperty(e)){let n=importFile._format(e);if(def.includes(n)){let l=document.getElementById("input-"+n);l.value=jsonInput[t][e].split(" ").join(""),validateElement(l)}if(opt.includes(n)){document.getElementById("check-"+opt[t]).checked=!0,document.getElementById("label-"+t).style.color="#107dac";let n=document.getElementById("input-"+t);n.disabled=!1,n.value=jsonInput[t][e].split(" ").join(""),validateElement(n)}}document.getElementById("sample-label").innerHTML="Sample <b style='color:#ac3dad'>"+e+"</b> loaded",$("#sample-label").show("slide",400),dialogImport.dialog("close");break}},reload:function(e){for(let t=0;t<e.length;t++)e[t]=$.extend(e[t],jsonParameters()),e[t].outputFormat=$("#import-extension").val();return e},_callback:function(e){if(0===e.length)return document.getElementById("samples").innerHTML="<p style='color:red;'><b>Error:</b><br>The input file is empty.</p>",jsonInput={},void $("#batch").button().attr("disabled",!0).addClass("ui-state-disabled");e[0].Marker?jsonInput=importFile._genemapper(e):(jsonInput=e,importFile._rename(jsonInput));let t=importFile._validate(jsonInput);if(t>0)if(1===jsonInput.length)importFile.load(jsonInput[0].description);else{document.getElementById("import-help").innerHTML="<b>"+jsonInput.length+" samples detected:</b>";let e="<i>Click on a sample to load its values in the form or use<br>the <b>Batch Query</b> option to search them all</i><br><br>";for(let t=0;t<jsonInput.length;t++)e+="<a class='sample' onclick='importFile.load(this.innerText)'>"+jsonInput[t].description+"</a><br>";document.getElementById("samples").innerHTML=e,$("#batch").button().attr("disabled",!1).removeClass("ui-state-disabled")}else-2===t?(document.getElementById("import-help").innerHTML="<b style='color:red;'>Error:</b>",document.getElementById("samples").innerHTML='<span style=\'color:red;\'>No sample could be detected in the input file. Please check that your file contains a "Name", "Sample" or "Sample Name" column.</span>',jsonInput={},$("#batch").button().attr("disabled",!0).addClass("ui-state-disabled")):-1===t?(document.getElementById("import-help").innerHTML="<b style='color:red;'>Error:</b>",document.getElementById("samples").innerHTML="<span style='color:red;'>Not all samples are named in the input file. Please name all your samples.</span>",jsonInput={},$("#batch").button().attr("disabled",!0).addClass("ui-state-disabled")):0===t&&(document.getElementById("import-help").innerHTML="<b style='color:red;'>Error:</b>",document.getElementById("samples").innerHTML="<span style='color:red;'>No compatible marker was detected in the input file.</span>",jsonInput={},$("#batch").button().attr("disabled",!0).addClass("ui-state-disabled"))},_genemapper:function(e){let t=[],n={},l=e[0]["Sample Name"];for(let o=0;o<e.length;o++){e[o]["Sample Name"]!==l&&(n.description=l,t.push(n),n={},l=e[o]["Sample Name"]);let s=[],a=1;for(;e[o]["Allele "+a];)""!==e[o]["Allele "+a]&&s.push(e[o]["Allele "+a]),a++;n[e[o].Marker]=s.join(",")}return n.description=l,t.push(n),t},_format:function(e){let t=e.trim().toUpperCase().replace(" ","_");switch(t){case"AM":case"AMEL":case"AMELOGENIN":return"Amelogenin";case"THO1":return"TH01";case"CSF1P0":return"CSF1PO";case"VWA":return"vWA";case"PENTA_C":case"PENTA_D":case"PENTA_E":return"Penta_"+t[t.length-1];default:return t}},_rename:function(e){let t=[];for(let n=0;n<e.length;n++)void 0!==e[n].SampleReferenceNbr?(e[n].description=importFile._renameCheck(t,e[n].SampleReferenceNbr),delete e[n].SampleReferenceNbr):void 0!==e[n].Sample?(e[n].description=importFile._renameCheck(t,e[n].Name),delete e[n].Sample):void 0!==e[n]["Sample Name"]?(e[n].description=importFile._renameCheck(t,e[n]["Sample Name"]),delete e[n]["Sample Name"]):void 0!==e[n].Name&&(e[n].description=importFile._renameCheck(t,e[n].Name),delete e[n].Name)},_renameCheck:function(e,t){if(e.includes(t)){let n=1;for(;e.includes(t+"("+n+")");)n++;return e.push(t+"("+n+")"),t+"("+n+")"}return e.push(t),t},_validate:function(e){if(e.some(e=>!e.hasOwnProperty("description")))return-2;if(e.some(e=>0===e.description.length))return-1;let t=0;for(let n=0;n<e.length;n++)for(let l in e[n])e[n].hasOwnProperty(l)&&(def.includes(l)||opt.includes(l))&&t++;return t},_csv:function(e){Papa.parse(e,{header:!0,skipEmptyLines:!0,complete:function(e){importFile._callback(e.data)}})},_xls:function(e){let t=new FileReader;t.onload=(e=>{const t=e.target.result,n=XLS.read(t,{type:"binary"}),l=n.SheetNames[0],o=n.Sheets[l],s=XLS.utils.sheet_to_json(o,{raw:!1,defval:""});importFile._callback(s)}),t.readAsBinaryString(e)},_xlsx:function(e){let t=new FileReader;t.onload=(e=>{const t=e.target.result,n=XLSX.read(t,{type:"binary"}),l=n.SheetNames[0],o=n.Sheets[l],s=XLSX.utils.sheet_to_json(o,{raw:!1,defval:""});importFile._callback(s)}),t.readAsBinaryString(e)},openDialog:function(){dialogImport.dialog("open")}},exportTable={toXlsx:function(e){$.ajax({type:"POST",url:"/cellosaurus-str-search/api/conversion",data:JSON.stringify(jsonResponse),contentType:"application/json",dataType:"text",mimeType:"text/plain; charset=x-user-defined",success:function(t,n,l){let o=e+".xlsx",s="";for(let e=0;e<t.length;e++)s+=String.fromCharCode(255&t.charCodeAt(e));let a=new Uint8Array(s.length);for(let e=0;e<s.length;e++)a[e]=s.charCodeAt(e);let r=l.getResponseHeader("Content-Type"),i=new Blob([a],{type:r}),d=window.URL||window.webkitURL,c=d.createObjectURL(i);if(o){let e=document.createElement("a");void 0===e.download?window.location=c:(e.href=c,e.download=o,document.body.appendChild(e),e.click())}else window.location=c;setTimeout(function(){d.revokeObjectURL(c)},100)},error:function(e,t,n){console.log(e),console.log(t),console.log(n),alert("Error: The server is not responding\nPlease contact an administrator")}})},toCsv:function(e){let t=this._tableToCSV(document.getElementById("table-results")),n=new Blob([t],{type:"text/csv"});navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(n,e+".csv"):this._downloadAnchor(URL.createObjectURL(n),e+".csv")},toJson:function(e){let t=new Blob([JSON.stringify(jsonResponse,void 0,2)],{type:"text/plain"});navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(t,e+".json"):this._downloadAnchor(URL.createObjectURL(t),e+".json")},_downloadAnchor:function(e,t){let n=document.createElement("a");n.style="display:none !important",n.id="downloadanchor",document.body.appendChild(n),"download"in n&&(n.download=t),n.href=e,n.click(),n.remove()},_tableToCSV:function(e){let t=[],n=[],l=',"#';l+="Description: '",l+=jsonResponse.description,l+="';Data set: 'Cellosaurus release ",l+=jsonResponse.cellosaurusRelease,l+="';Run on: '",l+=jsonResponse.runOn,l+="';Tool version: '",l+=jsonResponse.toolVersion,l+="';Algorithm: '",l+=jsonResponse.parameters.algorithm,l+="';Scoring mode: '",l+=jsonResponse.parameters.scoringMode,l+="';Score filter: '",l+=jsonResponse.parameters.scoreFilter,l+="';Max results: '",l+=jsonResponse.parameters.maxResults,l+="';Include Amelogenin: '",l+=jsonResponse.parameters.includeAmelogenin,l+="'\"";for(let o=0;o<e.rows.length;o++){for(let t=0;t<e.rows[0].cells.length;t++){let l='"';l+=e.rows[o].cells[t].textContent,0===t&&e.rows[o].cells[t].innerHTML.startsWith('<a title="Problematic')&&(l+=" (Problematic cell line)"),l+='"',n.push(l)}0===o?t.push(n.join(",")+l):t.push(n.join(",")),n=[]}return t.join("\r\n")},openDialog:function(){dialogExport.dialog("open")}};$(function(){(dialogImport=$("#dialog-import").dialog({autoOpen:!1,height:575,width:500,modal:!1,resizable:!1,closeText:null,hide:{effect:"fold",duration:300},show:{effect:"fold",duration:300},buttons:[{text:"Batch Query",disabled:!0,id:"batch",click:function(){html.addClass("waiting"),$("#import-progressbar").addClass("animate"),$.ajax({type:"POST",url:"/cellosaurus-str-search/api/batch",data:JSON.stringify(importFile.reload(jsonInput)),contentType:"application/json",dataType:"text",mimeType:"text/plain; charset=x-user-defined",success:function(e,t,n){let l=$("#import-extension").val(),o="csv"===l?"zip":l,s=$("#import-name").val()+"."+o,a="";for(let t=0;t<e.length;t++)a+=String.fromCharCode(255&e.charCodeAt(t));let r=new Uint8Array(a.length);for(let e=0;e<a.length;e++)r[e]=a.charCodeAt(e);let i=n.getResponseHeader("Content-Type"),d=new Blob([r],{type:i}),c=window.URL||window.webkitURL,u=c.createObjectURL(d);if(s){let e=document.createElement("a");void 0===e.download?window.location=u:(e.href=u,e.download=s,document.body.appendChild(e),e.click())}else window.location=u;setTimeout(function(){c.revokeObjectURL(u)},100)},error:function(e,t,n){console.log(e),console.log(t),console.log(n),alert("Error: The server is not responding\nPlease contact an administrator")},complete:function(){dialogImport.dialog("close"),html.removeClass("waiting"),$("#import-progressbar").removeClass("animate")}})}},{text:"Close",click:function(){dialogImport.dialog("close")}}]})).find("form").on("submit",function(e){e.preventDefault()}),(dialogExport=$("#dialog-export").dialog({autoOpen:!1,height:350,width:450,modal:!0,resizable:!1,closeText:null,hide:{effect:"fold",duration:300},show:{effect:"fold",duration:300},buttons:{Save:function(){let e=$("#export-name").val(),t=$("#export-progressbar");switch(html.addClass("waiting"),t.addClass("animate"),jsonResponse.description=$("#description").val(),document.getElementById("export-extension").value){case"xlsx":exportTable.toXlsx(e);break;case"csv":exportTable.toCsv(e);break;case"json":exportTable.toJson(e);break;case"pdf":exportTable.toPdf(e)}dialogExport.dialog("close"),t.removeClass("animate"),html.removeClass("waiting")},Close:function(){dialogExport.dialog("close")}},open:function(){$("#content").addClass("blur")},close:function(){$("#content").removeClass("blur")}})).find("form").on("submit",function(e){e.preventDefault()}),$(document).tooltip({content:function(){return $(this).prop("title")},position:{my:"left center",at:"right+15 center"},show:null,close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})});