var def="Amelogenin CSF1PO D2S1338 D3S1358 D5S818 D7S820 D8S1179 D13S317 D16S539 D18S51 D19S433 D21S11 FGA Penta_D Penta_E TH01 TPOX vWA".split(" "),opt="D10S1248 D1S1656 D2S441 D6S1043 D12S391 D22S1045 DXS101 DYS391 F13A01 F13B FESFPS LPL Penta_C SE33".split(" "),all="Amelogenin CSF1PO D1S1656 D2S1338 D2S441 D3S1358 D5S818 D6S1043 D7S820 D8S1179 D10S1248 D12S391 D13S317 D16S539 D18S51 D19S433 D21S11 D22S1045 DXS101 DYS391 F13A01 F13B FESFPS FGA LPL Penta_C Penta_D Penta_E SE33 TH01 TPOX vWA".split(" "),
    html=$("html"),jsonInput,jsonQuery,jsonResponse,dialogImport,dialogExport;$(document).ready(function(){resetAll();parseURLVariables();bindEvents()});
function resetAll(){resetMarkers();document.getElementById("input-tanabe").checked=!0;document.getElementById("input-nonempty").checked=!0;document.getElementById("check-include-Amelogenin").checked=!1;document.getElementById("filter-score").value=60;document.getElementById("filter-size").value=200;document.getElementById("results").style.display="none";document.getElementById("warning").style.display="none";document.getElementById("importName").value="Cellosaurus_STR_Results";document.getElementById("exportName").value=
    "Cellosaurus_STR_Results";document.getElementById("importExtension").value="xlsx";document.getElementById("exportExtension").value="xlsx";document.getElementById("inputFile").value="";document.getElementById("importHelp").innerHTML="";document.getElementById("samples").innerHTML="";document.getElementById("sample-label").innerHTML="";document.getElementById("sample-label").style.display="none";document.getElementById("warning").style.opacity="0";document.getElementById("results").style.opacity="0";
    switchIcon("import","xlsx");switchIcon("export","xlsx")}
function resetMarkers(){for(var a=0;a<def.length;a++)document.getElementById("input-"+def[a]).value="",document.getElementById("input-"+def[a]).style.color="#000000",document.getElementById("input-"+def[a]).style.borderColor="#ccc";for(a=0;a<opt.length;a++)document.getElementById("input-"+opt[a]).value="",document.getElementById("input-"+opt[a]).style.color="#000000",document.getElementById("input-"+opt[a]).style.borderColor="#ccc",document.getElementById("check-"+opt[a]).checked=!1,document.getElementById("input-"+
    opt[a]).disabled=!0,document.getElementById("input-"+opt[a]).value="",document.getElementById("label-"+opt[a]).style.color="#7e7e7e"}
function parseURLVariables(){if(0<window.location.search.length)for(var a=window.location.search.substring(1).split("&"),b=0;b<a.length;b++)if(void 0!==a[b]&&0!==a[b].length&&a[b].includes("=")){var c=a[b].split("="),d=c[0].split("%20").join("_");c=c[1].split("%20").join("").split("%22").join("").split("%27").join("");-1!==def.indexOf(d)?document.getElementById("input-"+d).value=c:-1!==opt.indexOf(d)?(document.getElementById("input-"+d).value=c,document.getElementById("input-"+d).disabled=!1,document.getElementById("check-"+
    d).checked=!0,document.getElementById("label-"+d).style.color="#107dac"):"name"===d&&(document.getElementById("sample-label").innerHTML="Cellosaurus entry <b style='color:#ac3dad'>"+c+"</b> loaded",$("#sample-label").show("slide",400))}}
function bindEvents(){for(var a=0;a<def.length;a++){var b=document.getElementById("input-"+def[a]);b.onkeypress=0===a?b.onpaste=restrictXYEvent:b.onpaste=restrictSTREvent;b.onblur=blurEvent;b.oninput=inputEvent;validateElement(b)}for(a=0;a<opt.length;a++)b=document.getElementById("input-"+opt[a]),b.onkeypress=b.onpaste=restrictSTREvent,b.onblur=blurEvent,b.oninput=inputEvent,validateElement(b);window.onscroll=scrollable}
function restrictXYEvent(a){if(a.ctrlKey||" "===a.key||"Backspace"===a.key||"Delete"===a.key)return!0;a="keypress"===a.type?String.fromCharCode(a.keyCode||a.which):(a.clipboardData||window.clipboardData).getData("Text");return!/[^\sxy,]/i.test(a)}function restrictSTREvent(a){if(a.ctrlKey||" "===a.key||"Backspace"===a.key||"Delete"===a.key)return!0;a="keypress"===a.type?String.fromCharCode(a.keyCode||a.which):(a.clipboardData||window.clipboardData).getData("Text");return!/[^\s\d,.]/.test(a)}
function inputEvent(){document.getElementById("sample-label").innerHTML=""}function blurEvent(a){validateElement(document.getElementById(a.target.id))}
function validateElement(a){var b=a.value.split(" ").join("");0===b.length?a.style="color:#000000;border-color:#ccc":/[,.]{2,}|\d{3,}|(\.\d{2,}|[,.]$|^[,.])/.test(b)?a.style="color:#ff0000;border-color:#ff0000":"input-Amelogenin"===a.id?/^[XY,]+$/.test(b)?a.style="color:#000000;border-color:#ccc":a.style="color:#ff0000;border-color:#ff0000":/^[0-9,.]+$/.test(b)?a.style="color:#000000;border-color:#ccc":a.style="color:#ff0000;border-color:#ff0000"}
function scrollable(){20<document.body.scrollTop||20<document.documentElement.scrollTop?document.getElementById("scroller").style.display="block":document.getElementById("scroller").style.display="none"}function scrollUp(){document.body.scrollIntoView({behavior:"instant",block:"start",inline:"nearest"})}
function switchIcon(a,b){document.getElementById(a+"Xlsx").style.display="none";document.getElementById(a+"Csv").style.display="none";document.getElementById(a+"Json").style.display="none";document.getElementById(a+"Pdf").style.display="none";switch(b){case "xlsx":document.getElementById(a+"Xlsx").style.display="block";break;case "csv":document.getElementById(a+"Csv").style.display="block";break;case "json":document.getElementById(a+"Json").style.display="block";break;case "pdf":document.getElementById(a+
    "Pdf").style.display="block"}}function jsonParameters(){var a={};a.algorithm=$("input[name=score]:checked").val();a.scoringMode=$("input[name=mode]:checked").val();a.scoreFilter=document.getElementById("filter-score").value;a.maxResults=document.getElementById("filter-size").value;a.includeAmelogenin=document.getElementById("check-include-Amelogenin").checked;return a}
function search(){jsonQuery={};for(var a=0;a<def.length;a++){var b=document.getElementById("input-"+def[a]).value.split(" ").join("");""!==b&&(jsonQuery[def[a].split("_").join(" ")]=b)}for(a=0;a<opt.length;a++)b=document.getElementById("input-"+opt[a]).value.split(" ").join(""),""!==b&&(jsonQuery[opt[a].split("_").join(" ")]=b);0===Object.keys(jsonQuery).length?(document.getElementById("results").style.display="none",document.getElementById("warning").style.display="block",$("#warning").animate({opacity:1},
    400,"swing"),document.getElementById("warning").scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})):(jsonQuery.outputFormat="json",jQuery.extend(jsonQuery,jsonParameters()),html.addClass("waiting"),$.ajax({type:"POST",url:"/cellosaurus-str-search/api/query",data:JSON.stringify(jsonQuery),contentType:"application/json",dataType:"json",success:function(a,b,e){0!==a.results.length?(jsonResponse=a,table.build(a),document.getElementById("results").style.display="table",$("#results").animate({opacity:1},
        1E3,"swing"),document.getElementById("warning").style.display="none",document.getElementById("caption").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})):(document.getElementById("results").style.display="none",document.getElementById("warning").style.display="block",$("#warning").animate({opacity:1},400,"swing"),document.getElementById("warning").scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}))},error:function(a,b,e){console.log(a);console.log(b);console.log(e);
        alert("Error: The server is not responding\nPlease contact an administrator")},complete:function(){html.removeClass("waiting")}}))}
var table={build:function(a){var b,c,d,e=[];Array.prototype.push.apply(e,all);for(d=0;d<opt.length;d++)!1===document.getElementById("check-"+opt[d]).checked&&e.splice(e.indexOf(opt[d]),1);var h="";var f="<tr><th class='unselectable b0'><p class=\"sort-by\">Accession</p></th><th class='unselectable'><p class=\"sort-by\">Name</p></th><th class='unselectable'><p class=\"sort-by\">N\u00ba Markers</p></th></th><th class='unselectable'><p class=\"sort-by\">Score</p></th>";for(d=0;d<e.length;d++){var g=
        e[d].split("_").join(" ");"Amelogenin"===g&&(g="Amel");f+="<th class='unselectable'><p class=\"sort-by\">"+g+"</p></th>";h+="<td>"+document.getElementById("input-"+e[d]).value+"</td>"}f+="</tr><tr><td class='b0'>NA</td><td>Query</td><td>NA</td><td>NA</td></td>"+h+"</tr>";for(d=0;d<a.results.length;d++)for(g in h={},a.results[d].profiles){for(b in a.results[d].profiles[g].markers){var l=[];for(c in a.results[d].profiles[g].markers[b].alleles){var k=a.results[d].profiles[g].markers[b].alleles[c];!1===
    k.matched?l.push("<span style='color:red'>"+k.value+"</span>"):l.push(k.value)}k=a.results[d].profiles[g].markers[b].name.split(" ").join("_");-1<e.indexOf(k)&&(h[k]=a.results[d].profiles[g].markers[b].conflicted?'<a class="as" title="'+table._formatSources(a.results[d].profiles[g].markers[b].sources)+'">'+l.join(",")+"</a>":l.join(","))}f+="<tr>";l="1"===$("input[name=score]:checked").val()?90<=a.results[d].profiles[g].score?"b1":80>a.results[d].profiles[g].score?"b2":"b3":80<=a.results[d].profiles[g].score?
        "b1":60>a.results[d].profiles[g].score?"b2":"b3";k=0==g&&2===a.results[d].profiles.length?" <span style='color:#373434'><i>Best</i></span>":1==g?" <span style='color:#373434'><i>Worst</i></span>":"";f=a.results[d].problematic?f+("<td class='"+l+"'><a title=\""+table._formatDescription(a.results[d].problem)+"\" style='color:red' href=\"https://web.expasy.org/cellosaurus/"+a.results[d].accession+'" target="_blank">'+a.results[d].accession+"</a>"+k+"</td>"):f+("<td class='"+l+"'><a href=\"https://web.expasy.org/cellosaurus/"+
        a.results[d].accession+'" target="_blank">'+a.results[d].accession+"</a>"+k+"</td>");f+="<td>"+a.results[d].name+"</td>";f=document.getElementById("check-include-Amelogenin").checked&&9>a.results[d].profiles[g].markerNumber||!document.getElementById("check-include-Amelogenin").checked&&8>a.results[d].profiles[g].markerNumber?f+("<td><span style='color:red' title='A minimum of eight STR markers (excluding Amelogenin) is recommended'>"+a.results[d].profiles[g].markerNumber+"</span></td>"):f+("<td>"+
        a.results[d].profiles[g].markerNumber+"</td>");f+="<td>"+a.results[d].profiles[g].score.toFixed(2)+"%</td>";for(l=0;l<e.length;l++)k=h[e[l]],void 0===k&&(k=""),f+="<td>"+k+"</td>";f+="</tr>"}a=$("#table-results");a.empty();a.append(f);table._makeSortable()},_formatDescription:function(a){return"<b>Problematic cell line:</b><br><span style='color:red;'>"+a.replace(".","</span>.").replace(/(PubMed=)(\d+)/g,"$1<a class='ab' href='https://www.ncbi.nlm.nih.gov/pubmed/$2' target='_blank'>$2</a>").replace(/(DOI=)([\w/.]+)/g,
        "$1<a class='ab' href='https://www.doi.org/$2' target='_blank'>$2</a>")},_formatSources:function(a){var b="<b>Source";1<a.length&&(b+="s");b+=":</b><br>";for(var c=0;c<a.length;c++)a[c].startsWith("PubMed")?(b+=a[c].substring(0,7),b+="<a class='ab' href='https://www.ncbi.nlm.nih.gov/pubmed/",b+=a[c].substring(7),b+="' target='_blank'>",b+=a[c].substring(7),b+="</a><br>"):a[c].startsWith("DOI")?(b+=a[c].substring(0,4),b+="<a class='ab' href='https://www.doi.org/",b+=a[c].substring(4),b+="' target='_blank'>",
        b+=a[c].substring(4),b+="</a><br>"):(b+=a[c],b+="<br>");return b},_makeSortable:function(){var a=this,b=function(a,b){return a.children[b].innerText||a.children[b].textContent},c=function(a,c){return function(d,e){var g=b(c?d:e,a),f=b(c?e:d,a);if(""===g||""===f||isNaN(g)||isNaN(f)){if(g.endsWith("%")){for(;7>g.length;)g="0"+g;for(;7>f.length;)f="0"+f}f=g.toString().localeCompare(f)}else f=g-f;return f}};document.querySelectorAll("th").forEach(function(b){return b.addEventListener("click",function(){for(var d=
        document.querySelectorAll("th"),h=0;h<d.length;h++)d[h].getElementsByClassName("sort-by")[0].className="sort-by";a.asc?b.getElementsByClassName("sort-by")[0].className="sort-by asc":b.getElementsByClassName("sort-by")[0].className="sort-by des";var f=b.closest("table");Array.from(f.querySelectorAll("tr:nth-child(n+3)")).sort(c(Array.from(b.parentNode.children).indexOf(b),a.asc=!a.asc)).forEach(function(a){return f.appendChild(a)})})})}};
function example(){resetMarkers();document.getElementById("input-Amelogenin").value="X";document.getElementById("input-CSF1PO").value="11,12";document.getElementById("input-D2S1338").value="19,23";document.getElementById("input-D3S1358").value="15,17";document.getElementById("input-D5S818").value="11,12";document.getElementById("input-D7S820").value="10";document.getElementById("input-D8S1179").value="10";document.getElementById("input-D13S317").value="11,12";document.getElementById("input-D16S539").value=
    "11,12";document.getElementById("input-D18S51").value="13";document.getElementById("input-D19S433").value="14";document.getElementById("input-D21S11").value="29,30";document.getElementById("input-FGA").value="20,22";document.getElementById("input-Penta_D").value="11,13";document.getElementById("input-Penta_E").value="14,16";document.getElementById("input-TH01").value="6,9";document.getElementById("input-TPOX").value="8,9";document.getElementById("input-vWA").value="17,19";document.getElementById("description").value=
    "HT-29";document.getElementById("sample-label").innerHTML="Example <b style='color:#ac3dad'>HT-29</b> loaded";$("#sample-label").show("slide",400)}function check(a){document.getElementById("input-"+a).disabled?(document.getElementById("input-"+a).disabled=!1,document.getElementById("label-"+a).style.color="#107dac"):(document.getElementById("input-"+a).disabled=!0,document.getElementById("input-"+a).value="",document.getElementById("label-"+a).style.color="#7e7e7e")}
var importFile={read:function(a){if(void 0!==a[0])switch(a[0].name.split(".").pop()){case "csv":case "tsv":case "txt":importFile._csv(a[0]);break;case "xls":importFile._xls(a[0]);break;case "xlsx":importFile._xlsx(a[0])}},load:function(a){for(var b=0;b<jsonInput.length;b++)if(jsonInput[b].description===a){resetMarkers();document.getElementById("description").value=a;for(var c in jsonInput[b])if(jsonInput[b].hasOwnProperty(c)){var d=importFile._format(c);if(def.includes(d)){var e=document.getElementById("input-"+
        d);e.value=jsonInput[b][c].split(" ").join("");validateElement(e)}opt.includes(d)&&(document.getElementById("check-"+opt[b]).checked=!0,document.getElementById("label-"+b).style.color="#107dac",e=document.getElementById("input-"+b),e.disabled=!1,e.value=jsonInput[b][c].split(" ").join(""),validateElement(e))}document.getElementById("sample-label").innerHTML="Sample <b style='color:#ac3dad'>"+a+"</b> loaded";$("#sample-label").show("slide",400);dialogImport.dialog("close");break}},reload:function(a){for(var b=
            0;b<a.length;b++)a[b]=$.extend(a[b],jsonParameters()),a[b].outputFormat=$("#importExtension").val();return a},_callback:function(a){if(0===a.length)document.getElementById("samples").innerHTML="<p style='color:red;'><b>Error:</b><br>The input file is empty.</p>",jsonInput={},$("#batch").button().attr("disabled",!0).addClass("ui-state-disabled");else if(a[0].Marker?jsonInput=importFile._genemapper(a):(jsonInput=a,importFile._rename(jsonInput)),a=importFile._validate(jsonInput),0<a)if(1===jsonInput.length)importFile.load(jsonInput[0].description);
        else{document.getElementById("importHelp").innerHTML="<b>"+jsonInput.length+" samples detected:</b>";a="<i>Click on a sample to load its values in the form or use<br>the <b>Batch Query</b> option to search them all</i><br><br>";for(var b=0;b<jsonInput.length;b++)a+="<a class='sample' onclick='importFile.load(this.innerText)'>"+jsonInput[b].description+"</a><br>";document.getElementById("samples").innerHTML=a;$("#batch").button().attr("disabled",!1).removeClass("ui-state-disabled")}else-2===a?(document.getElementById("importHelp").innerHTML=
            "<b style='color:red;'>Error:</b>",document.getElementById("samples").innerHTML='<span style=\'color:red;\'>No sample could be detected in the input file. Please check that your file contains a "Name", "Sample" or"Sample Name" column.</span>',jsonInput={},$("#batch").button().attr("disabled",!0).addClass("ui-state-disabled")):-1===a?(document.getElementById("importHelp").innerHTML="<b style='color:red;'>Error:</b>",document.getElementById("samples").innerHTML="<span style='color:red;'>Not all samples are named in the input file. Please name all your samples.</span>",
            jsonInput={},$("#batch").button().attr("disabled",!0).addClass("ui-state-disabled")):0===a&&(document.getElementById("importHelp").innerHTML="<b style='color:red;'>Error:</b>",document.getElementById("samples").innerHTML="<span style='color:red;'>No compatible marker was detected in the input file.</span>",jsonInput={},$("#batch").button().attr("disabled",!0).addClass("ui-state-disabled"))},_genemapper:function(a){for(var b=[],c={},d=a[0]["Sample Name"],e=0;e<a.length;e++){a[e]["Sample Name"]!==d&&
        (c.description=d,b.push(c),c={},d=a[e]["Sample Name"]);for(var h=[],f=1;a[e]["Allele "+f];)""!==a[e]["Allele "+f]&&h.push(a[e]["Allele "+f]),f++;c[a[e].Marker]=h.join(",")}c.description=d;b.push(c);return b},_format:function(a){a=a.trim().toUpperCase().replace(" ","_");switch(a){case "AM":case "AMEL":case "AMELOGENIN":return"Amelogenin";case "THO1":return"TH01";case "CSF1P0":return"CSF1PO";case "VWA":return"vWA";case "PENTA_C":case "PENTA_D":case "PENTA_E":return"Penta_"+a[a.length-1];default:return a}},
        _rename:function(a){for(var b=[],c=0;c<a.length;c++)void 0!==a[c].SampleReferenceNbr?(a[c].description=importFile._renameCheck(b,a[c].SampleReferenceNbr),delete a[c].SampleReferenceNbr):void 0!==a[c].Sample?(a[c].description=importFile._renameCheck(b,a[c].Name),delete a[c].Sample):void 0!==a[c]["Sample Name"]?(a[c].description=importFile._renameCheck(b,a[c]["Sample Name"]),delete a[c]["Sample Name"]):void 0!==a[c].Name&&(a[c].description=importFile._renameCheck(b,a[c].Name),delete a[c].Name)},_renameCheck:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                b){if(a.includes(b)){for(var c=1;a.includes(b+"("+c+")");)c++;a.push(b+"("+c+")");return b+"("+c+")"}a.push(b);return b},_validate:function(a){if(a.some(function(a){return!a.hasOwnProperty("description")}))return-2;if(a.some(function(a){return 0===a.description.length}))return-1;for(var b=0,c=0;c<a.length;c++)for(var d in a[c])a[c].hasOwnProperty(d)&&(def.includes(d)||opt.includes(d))&&b++;return b},_csv:function(a){Papa.parse(a,{header:!0,skipEmptyLines:!0,complete:function(a){importFile._callback(a.data)}})},
        _xls:function(a){var b=new FileReader;b.onload=function(a){a=XLS.read(a.target.result,{type:"binary"});a=XLS.utils.sheet_to_json(a.Sheets[a.SheetNames[0]],{raw:!1,defval:""});importFile._callback(a)};b.readAsBinaryString(a)},_xlsx:function(a){var b=new FileReader;b.onload=function(a){a=XLSX.read(a.target.result,{type:"binary"});a=XLSX.utils.sheet_to_json(a.Sheets[a.SheetNames[0]],{raw:!1,defval:""});importFile._callback(a)};b.readAsBinaryString(a)},openDialog:function(){dialogImport.dialog("open")}},
    exportTable={toXlsx:function(a){document.getElementById("exportProgress").style.width="30%";$.ajax({type:"POST",url:"/cellosaurus-str-search/api/conversion",data:JSON.stringify(jsonResponse),contentType:"application/json",dataType:"text",mimeType:"text/plain; charset=x-user-defined",success:function(b,c,d){document.getElementById("exportProgress").style.width="40%";c=a+".xlsx";for(var e="",h=0;h<b.length;h++)e+=String.fromCharCode(b.charCodeAt(h)&255);b=new Uint8Array(e.length);for(h=0;h<e.length;h++)b[h]=
                e.charCodeAt(h);d=d.getResponseHeader("Content-Type");d=new Blob([b],{type:d});var f=window.URL||window.webkitURL,g=f.createObjectURL(d);document.getElementById("exportProgress").style.width="60%";c?(d=document.createElement("a"),"undefined"===typeof d.download?window.location=g:(d.href=g,d.download=c,document.body.appendChild(d),d.click())):window.location=g;document.getElementById("exportProgress").style.width="80%";setTimeout(function(){f.revokeObjectURL(g)},100)},error:function(a,c,d){console.log(a);
                console.log(c);console.log(d);alert("Error: The server is not responding\nPlease contact an administrator")},complete:function(){html.removeClass("waiting")}})},toCsv:function(a){document.getElementById("exportProgress").style.width="40%";var b=this._tableToCSV(document.getElementById("table-results"));b=new Blob([b],{type:"text/csv"});document.getElementById("exportProgress").style.width="60%";navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(b,a+".csv"):this._downloadAnchor(URL.createObjectURL(b),
            a+".csv");document.getElementById("exportProgress").style.width="80%"},toJson:function(a){document.getElementById("exportProgress").style.width="40%";var b=new Blob([JSON.stringify(jsonResponse,void 0,2)],{type:"text/plain"});document.getElementById("exportProgress").style.width="60%";navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(b,a+".json"):this._downloadAnchor(URL.createObjectURL(b),a+".json");document.getElementById("exportProgress").style.width="80%"},toPdf:function(a){document.getElementById("exportProgress").style.width=
            "40%";var b=$("#table-results"),c=b.width()>b.height()+2?"l":"p";a={margin:0,filename:a+".pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"px",format:[b.width(),b.height()+2],orientation:c}};document.getElementById("exportProgress").style.width="60%";html2pdf().set(a).from(document.getElementById("table-results")).save();document.getElementById("exportProgress").style.width="80%"},_downloadAnchor:function(a,b){var c=document.createElement("a");c.style="display:none !important";
            c.id="downloadanchor";document.body.appendChild(c);"download"in c&&(c.download=b);c.href=a;c.click();c.remove()},_tableToCSV:function(a){var b=[],c=[];var d=",\"#Description: '"+jsonResponse.description;d=d+"';Data set: 'Cellosaurus release "+jsonResponse.cellosaurusRelease;d=d+"';Run on: '"+jsonResponse.runOn;d=d+"';Tool version: '"+jsonResponse.toolVersion;d=d+"';Algorithm: '"+jsonResponse.parameters.algorithm;d=d+"';Scoring mode: '"+jsonResponse.parameters.scoringMode;d=d+"';Score filter: '"+jsonResponse.parameters.scoreFilter;
            d=d+"';Max results: '"+jsonResponse.parameters.maxResults;d=d+"';Include Amelogenin: '"+jsonResponse.parameters.includeAmelogenin;d+="'\"";for(var e=0;e<a.rows.length;e++){for(var h=0;h<a.rows[0].cells.length;h++){var f='"';f+=a.rows[e].cells[h].textContent;0===h&&a.rows[e].cells[h].innerHTML.startsWith('<a title="Problematic')&&(f+=" (Problematic cell line)");f+='"';c.push(f)}0===e?b.push(c.join(",")+d):b.push(c.join(","));c=[]}return b.join("\r\n")},openDialog:function(){dialogExport.dialog("open")}};
$(function(){dialogImport=$("#dialog-import").dialog({autoOpen:!1,height:600,width:500,modal:!1,resizable:!1,closeText:null,hide:{effect:"fold",duration:300},show:{effect:"fold",duration:300},buttons:[{text:"Batch Query",disabled:!0,id:"batch",click:function(){html.addClass("waiting");document.getElementById("importProgress").style.width="10%";$.ajax({type:"POST",url:"/cellosaurus-str-search/api/batch",data:JSON.stringify(importFile.reload(jsonInput)),contentType:"application/json",dataType:"text",
            mimeType:"text/plain; charset=x-user-defined",success:function(a,b,c){document.getElementById("importProgress").style.width="70%";b="csv"===$("#importExtension").val()?"zip":$("#importExtension").val();b=$("#importName").val()+"."+b;for(var d="",e=0;e<a.length;e++)d+=String.fromCharCode(a.charCodeAt(e)&255);a=new Uint8Array(d.length);for(e=0;e<d.length;e++)a[e]=d.charCodeAt(e);c=c.getResponseHeader("Content-Type");c=new Blob([a],{type:c});var h=window.URL||window.webkitURL,f=h.createObjectURL(c);
                document.getElementById("importProgress").style.width="80%";b?(c=document.createElement("a"),"undefined"===typeof c.download?window.location=f:(c.href=f,c.download=b,document.body.appendChild(c),c.click())):window.location=f;document.getElementById("importProgress").style.width="90%";setTimeout(function(){h.revokeObjectURL(f)},100);dialogImport.dialog("close");document.getElementById("importProgress").style.width="100%"},error:function(a,b,c){console.log(a);console.log(b);console.log(c);alert("Error: The server is not responding\nPlease contact an administrator")},
            complete:function(){html.removeClass("waiting");document.getElementById("importProgress").style.width="0%"}})}},{text:"Close",click:function(){dialogImport.dialog("close")}}]});dialogImport.find("form").on("submit",function(a){a.preventDefault()});dialogExport=$("#dialog-export").dialog({autoOpen:!1,height:350,width:450,modal:!0,resizable:!1,closeText:null,hide:{effect:"fold",duration:300},show:{effect:"fold",duration:300},buttons:{Save:function(){html.addClass("waiting");jsonResponse.description=
            $("#description").val();document.getElementById("exportProgress").style.width="10%";switch(document.getElementById("exportExtension").value){case "xlsx":exportTable.toXlsx($("#exportName").val());break;case "csv":exportTable.toCsv($("#exportName").val());break;case "json":exportTable.toJson($("#exportName").val());break;case "pdf":exportTable.toPdf($("#exportName").val())}html.removeClass("waiting");document.getElementById("exportProgress").style.width="100%";dialogExport.dialog("close");document.getElementById("exportProgress").style.width=
            "0%"},Close:function(){dialogExport.dialog("close")}},open:function(){$("#content").addClass("blur")},close:function(){$("#content").removeClass("blur")}});dialogExport.find("form").on("submit",function(a){a.preventDefault()});$(document).tooltip({content:function(){return $(this).prop("title")},position:{my:"left center",at:"right+15 center"},show:null,close:function(a,b){b.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})});